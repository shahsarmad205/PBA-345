<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up - Step 2 | BudgetMate</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="form-container">
      <h2>Sign Up - Step 2: Income Information</h2>
      <form id="income-form" class="signup-form">
        <label for="employment">Employment Status</label>
        <select id="employment" name="employment" required>
          <option value="" disabled selected>Select your status</option>
          <option value="employed">Employed</option>
          <option value="self-employed">Self-Employed</option>
          <option value="student">Student</option>
          <option value="unemployed">Unemployed</option>
          <option value="other">Other</option>
        </select>

        <label for="income">Monthly Income ($)</label>
        <input type="number" id="income" name="income" min="0" required />

        <label for="source">Income Source(s)</label>
        <input
          type="text"
          id="source"
          name="source"
          placeholder="e.g. Job, Freelancing"
          required
        />

        <div class="recurring">
          <input type="checkbox" id="recurring" name="recurring" />
          <label for="recurring">This income is recurring</label>
        </div>

        <div class="form-nav">
          <button type="submit" class="next-btn">Next â†’</button>
        </div>
      </form>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const incomeForm = document.getElementById("income-form");

        incomeForm.addEventListener("submit", async (e) => {
          e.preventDefault();

          const employment = document.getElementById("employment").value;
          const amount = parseFloat(document.getElementById("income").value);
          const source = document.getElementById("source").value.trim();
          const recurring = document.getElementById("recurring").checked;
          const token = localStorage.getItem("token");

          if (!employment || isNaN(amount) || !source || !token) {
            alert("Please fill in all fields.");
            return;
          }

          try {
            const today = new Date().toISOString().split("T")[0];

            const response = await fetch(
              "http://127.0.0.1:5001/api/income/add",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${token}`,
                },
                body: JSON.stringify({
                  source,
                  amount,
                  recurring,
                  date: today,
                }),
              }
            );

            if (!response.ok) {
              const err = await response.json();
              throw new Error(err.message || "Failed to save income");
            }

            window.location.href = "signup-expenses.html";
          } catch (err) {
            alert("Error saving income: " + err.message);
          }
        });
      });
    </script>
  </body>
</html>
